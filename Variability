library(raster)
library(RStoolbox)
library(ggplot2)
library(patchwork)
install.packages("viridis")
library(viridis)

setwd("C:/lab/")

similaun <- brick("sentinel_similaun.png")
sim_red <- ggRGB(similaun, 1, 2, 3, stretch = "lin" ) #N.B. ggRGB usa lo stretch="lin" di default
sim_green <- ggRGB(similaun, 2, 1, 3, stretch = "lin" ) # l'infrarosso (=vegetazione) è sulla banda del verde
sim_red+sim_green

nir <- similaun$sentinel_similaun.1

st_dev <- focal( nir,
       matrix(1/9, 3, 3), #1/9 è unità minima, 3 e 3 sono dimensioni
       fun=sd #sd è deviazione standard
       ) #permette di calcolare un valore a scelta tramite una finestra mobile di dimensioni scelte; valore messo nel pixel centrale

variazione <- colorRampPalette(c("blue", "green", "pink", "magenta", "orange", "brown", "red", "yellow"))(100)

plot(st_dev, col=viridis) #plotta la variabilità dell'immagine tramite il calcolo della deviazione standard

ggplot() + #apre un ggPlot vuoto  
geom_raster(sd, mapping=aes(x=x, y=y, fill=layer)) + #colorazione generale
scale_fill_viridis(option = "magma") +
ggtitle("Standard deviation by viridis colour scale")
 
st_dev7 <- focal(nir, matrix(1/49, 7, 7), fun=sd) 
